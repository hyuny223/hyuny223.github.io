---
title: "[ROS Week3 Day1] ROS프로그래밍 기초(2)"
categories: dev_ROS
tag: [ROS]

toc: true
toc_sticky: true
toc_label : 목차


date: 2022-02-28 00:00:04
last_modified_at: 2022-02-28
---
<br>
<br>

# 1. ROS의 구조와 기능 소개
---
##  1. ROS(Robot Operating System)
* 오픈소스 로봇 운영체제
* 로봇 소프트웨어를 개발하는 데 필요한 소프트웨어의 집합체
    - 즉, 소프트웨어 프레임워크
* 메타운영체제, 미들웨어
    - 소프트웨어 모듈 + 라이브러리 집합 + 도구 집합

## 2. ROS의 특징
* 로봇 SW를 만들기 위한 코드의 재사용이 용이한 환경제공이 목표
    - 다양한 프로그래밍 언어
    - 표준화된 ROS 인터페이스 → HW와 SW의 결합 용이
    - HW부품 + SW 부품 → 여러 응용
    - 대규모 실행 시스템 및 프로세스 적용 가능
* 다양한 도구들을 제공
* 다양한 OS환경에서 통일된 방법으로 상호작용 구현 가능
    - 표준화된 통신 프로토콜을 따르는 이기종간의 메시지 교환 가능

## 3. ROS에서의 통신
* 토픽의 발행&구독(publish & subscribe) 기반의 메시지 교환
    - 노드(pub,프로세스) → 토픽(메시지) → 노드(sub,프로세스)

## 4. ROS의 핵심 기능
* 노드간 통신 → 시스템 전체 구동
    - 하드웨어 부품 또는 소프트웨어 모듈에 노드가 하나씩 할당된다

* 네트워크를 통한 원격 연동 가능
    - 서로 분리된 하드웨어 장치 안에 있는 노드들간 통신
    - 물리적 거리는 필요조건이 아니다. 네트워크 연결 → 통신

## 5. ROS 기반의 구현사례
* 라이다 + 카메라 + 모터 + 상황인지SW + 운전판단SW
    - (라이다 + 카메라) → 상황인지SW → 운전판단SW → 모터(액츄에이터)
    - 라이다 → 급제동SW 추가 → 모터

## 6. ROS에서 사용하는 기본 용어
* 마스터(Master)
    - 서로 다른 노드들 사이의 통신을 총괄 관리
    - ROScore
* 노드(Nodes)
    - 실행가능한 최소 단위(프로세스)
    - ROS에서 발생하는 통신(메세지 송/수신)dml wncp
    - HW장치에 대해 하나씩의 노드, SW모듈에 대해 하나씩의 노드 할당
* 토픽(Topics)
    - 일종의 초대장
    - ROS 노드들이 관심을 갖고 있는 메세지
    - 안에 들어 있는 실제 데이터를 메세지라고 함
    - 센서데이터, 카메라이미지, 액츄에이터 제어명령 등
* 발행자(Publishers)
    - 메세지 → 특정 토픽 → 외부로 송신 → 노드
    - 센서, 카메라, 모터제어 알고리즘 등
* 구독자(Subscribers)
    - 특정 토픽에 담겨진 메세지를 수신하는 노드
    - 액츄에이터 제어기, 데이터 시각화 도구 등
* 패키지(Packages)
    - 묶음(하나 이상의 노드 & 노드의 실행을 위한 정보)
    - 노드, 라이브러리, 데이터, 파라미터 등을 포함

## 7. 간단한 ROS 응용 예
* 하드웨어 제조사가 제공하는 ROS 노드
    - 센서
        + 온도센서 하드웨어 → 온도센서 노드 → 토픽 "온도"
        + 습도센서 하드웨어 → 습도센서 노드 → 토픽 "습도"
        + 각각 어느 토픽에 어떤 형태의 메시지를 발행하는지 pre-defined
    - 액츄에이터
        + 토픽 "명령" → 에어컨제어 노드 → 에어컨 액츄에이터 하드웨어
        + 어느 토픽에 어떤 메세지를 발행하면 어떻게 동작하는지 pre-defined
    - ROS Core(마스터)가 노드들 사이의 메세지 통신 관장
        + \[토픽 "온도" & 토픽 "습도"\] → 제어 알고리즘 노드 → 토픽 "명령"
            * 퍼블리셔 노드는 주기적으로 각 토픽에 센싱데이터를 넣어서 발행
            * 제어알고리즘 노드는 수집된 데이터에 따른 제어결정을 내리고 명령을 발행
            * 서브스크라이브 노드는 명령 토픽을 구독하고 하드웨어(에어컨) 제어신호를 생성

## 8. ROS 노드간 통신 기본 과정
* 1번
    - 통신이 이루어지기 이전에 통신을 원하는 노드는 마스터에 의뢰
    - 연결해야 하는 노드의 정보(주소)를 얻어오고, 서로 접속정보를 교환
* 2번
    - 통신환경 구축 완료
    - 노드간 통신은 마스터를 거치지 않고 직접 이루어짐

## 9. ROS 노드간 통신의 두 가지 방식
* 토픽(topic) 방식의 통신
    - 일방적, 지속적인 메세지 전송
    - 1:1, 1:N, N:N
* 서비스(service) 방식의 통신
    - 서버가 제공하는 서비스에 클라이언트가 요청을 보내고 응답을 받는 방식
    - 양방향 통신, 일회성
    - 클라이언트: 서비스 요청(속도가 얼마?) → 서버: 서비스 응답(속도는 x)

## 10. ROS노드간 통신 시나리오
1. 마스터 시동(필요조건)
    * XMLRPC: 서버
    * http://ROS_MASTER_URI:11311
    * 노드 정보 관리
2. 구독자 노드 구동
   * SMLRPC: 클라이언트 
   * 특정 토픽(topic)에 발행되는 메세지를 수신하기를 요청
   * 구독자 노드의 정보
       + /subscriber_node_name
       + /topic_name
       + message_type
       + http://ROS_HOSTNAME:1234
3. 발행자 노드 구동
    * XMLRPC: 클라이언트
    * 특정 토픽 메세지를 발행하겠다는 의사 전달
    * 발행자 노드의 정보
       + /publisher_node_name
       + /topic_name
       + message_type
       + http://ROS_HOSTNAME:5678

4. 노드정보 전달
    * 마스터가 발행자 정보를 구독자에게 전달

5. 노드간 접속 요청
    * 구독자 노드가 발행자 노드에 TCPROS 접속 요청
    * 이때부터는 노드간의 직접적 접촉이 이루어짐

6. 노드간 접속 요청에 대한 응답
   * 발행자 노드가 자신의 TCPROS URI(포트 포함)를 전송하여 응답 

7. TCPROS 접속
   * 발행자 노드와 구독자 노드 사이에 소켓(socket) 연결이 이루어짐 

8. 메세지 전송
   * 발행자 노드가 구독자 노드에게 메세지 전송(토픽)

9. 메세지 전송 반복
    * 접속이 한 번 이루어진 후에는 별도 절차 없이 지속적으로 메세지 송수신


# 2. ROS 명령어
---
## 1. ROS 기본 용어
* 마스터
    + 노드간 통신 함괄
    + ROS Core 
* 노드
    + 토픽을 주고 받는 통신 주체
    + 실행가능한 최소 단위 프로세스
    + 하드웨어 장치에 하나씩 또는 소프트웨어 모듈에 하나씩 
* 토픽
    + 주고 받는 메세지
    + 센서데이터, 카메라이미지, 명령 등
* 발행자노드
    + 토픽을 만들어 보내는 노드
    + 정보수집센서, 카메라
* 구독자노드 
    + 토픽을 받는 노드
    + 모니터제어기, 정보수집SW모듈
* 패키지 
    + 묶음(하나 이상의 노드 & 노드 실행을 위한 정보)
    + 노드, 라이브러리, 데이터, 설정파일 등을 포함
